<html>
    <head>
        <title>Open Access Options at Leiden University</title>
        <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="javascript/datatables/DataTables-1.10.12/css/jquery.dataTables.min.css"/>
        <link href="css/styles.css" rel="stylesheet" />
        <meta name="viewport" content="width=device-width, initial-scale=1">


    </head>
    <body>
        <div class="container-fluid">
        <h1>Leiden Open aCcess Kit (LOCK)</h1>
        <div class="row">
            <div class="col-md-8">
        <p><strong>This page shows several ways to find out if your publication can be published under Open Access within the licensing deals of the University Libraries. If you check the Open Access box for publications in the journals mentioned, you will publish for free or at highly reduced rates. If your article was already published, the green options tell you how to make the article Open Access via for example the Leiden repository <a href="http://lucris.leidenuniv.nl">Lucris</a>.</strong></p>
            </div>
        </div>
        <div id="searchBox" class="row">
            <h2 class="row-fluid">Check Your Publication</h2>
        <div id="findJournal" class="col-md-4">
                <input type="text" id="journalSrch" name="journalSrch" placeholder="Journal title, issn or doi" />
                <input type="hidden" id="JournalIDSrch" name="JournalIDSrch" value="-1" />
                <button id="findJournalBtn" value="Submit" text="Search">Search</button>
        </div>
        <div id="searchResult" class="col-md-8">
            
        </div>
        </div>
       
        <div id="overView">
            
        </div>
        <div id="allJournals">
            <h2>All Journals</h2>
            <table id="journalTable">
                <thead>
                    <tr>
                        <th>Journal</th>
                        <th>Discount</th>
                        <th>Publisher</th>
                        <th>Impact</th>
                        <th>Quartile</th>
                        <th>Subject categories</th>
                    </tr>
                </thead>
                <tfoot>
                    <th>
                    </th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tfoot>
                </table>
        </div>
        </div>
        <script type="text/javascript" src="javascript/datatables/datatables.min.js"></script>
        <script type="text/javascript" src="javascript/jquery/jquery.mockjax.js"></script>
        <script type="text/javascript" src="javascript/autocomplete/jquery.autocomplete.js"></script>
        <script src="bootstrap/js/bootstrap.min.js"></script>


        <script type="text/javascript">
            $('#journalSrch').keypress(function(e) {
                                      if(e.which == 13) {
                                      var searchTerm = $('#journalSrch').val();
                                      checkJournal(searchTerm);
                                      return false;
                                      }
                                      });
            $('#findJournalBtn').click(function() {
                                       var searchTerm = $('#journalSrch').val();
                                       checkJournal(searchTerm);
                                       
            });
            
            function checkJournal(searchTerm) {
                $.get( "api/handler.php?action=search&q=" + searchTerm, function( data ) {
                      $( "#searchResult" ).html( data.html );
                      });
            }
        
            $('#journalSrch').autocomplete({
                serviceUrl: 'api/handler.php',
                onSelect: function (suggestion) {
                                           $('#JournalIDSrch').val(suggestion.data);
                                           checkJournal(suggestion.value);
                }
            });
            $.get( "api/handler.php?action=stats", function( data ) {
                  $( "#overView" ).html( data.html );
                  });
                  
                  
                  
                  
                  $('#journalTable').DataTable( {
                                               
                                               ajax: 'api/datatables.php',
                                               processing: true,
                                               serverSide: true,
                                               dataSrc: 'data',
                                               columns: [{data: 'Journal'}, {data: 'Reduction'}, {data: 'Publisher'}, {data:'Impact'},{data:'Quartile'},{data:'subject category', orderable: false}]
                                               
                                               } );

            $(document).ready(function() {
                              
                              // DataTable
                              var table = $('#journalTable').DataTable();
                              
                              table.on( 'xhr', function () {
                                       var json = table.ajax.json();
                                       
                                       
                                       var count = 0;
                                       $('#journalTable tfoot th').each( function () {
                                                                        var title = $(this).text();
                                                                        switch(count) {
                                                                        case (1):
                                                                        //discount
                                                                        var html = "<select>";
                                                                        
                                                                                 html = html + "<option></option>";
                                                                                 $.each(json.discountColumn, function(key,val){
                                                                                        // do something with key and val
                                                                                        if (json.discountColumn.length == 1) {
                                                                                        html = html + "<option selected>" + val + "</option>";
                                                                                        } else {
                                                                                        html = html + "<option>" + val + "</option>";
                                                                                        }
                                                                                        });
                                                                        
                                                                        html = html + "</select>";
                                                                        $(this).html(html);
                                                                        break;
                                                                        case (2):
                                                                        //publisher
                                                                        var html = "<select>";
                                                                        
                                                                        html = html + "<option></option>";
                                                                        $.each(json.publisherColumn, function(key,val){
                                                                               // do something with key and val
                                                                               if (json.publisherColumn.length == 1) {
                                                                               html = html + "<option selected>" + val + "</option>";
                                                                               } else {
                                                                               html = html + "<option>" + val + "</option>";
                                                                               }
                                                                               });
                                                                        
                                                                        html = html + "</select>";
                                                                        $(this).html(html);
                                                                        break;
                                                                        case(4):
                                                                        //quartile
                                                                        var html = "<select>";
                                                                        
                                                                        html = html + "<option></option>";
                                                                        $.each(json.quartileColumn, function(key,val){
                                                                               // do something with key and val
                                                                               if (json.quartileColumn.length == 1) {
                                                                               html = html + "<option selected>" + val + "</option>";
                                                                               } else {
                                                                               html = html + "<option>" + val + "</option>";
                                                                               }
                                                                               });
                                                                        
                                                                        html = html + "</select>";
                                                                        $(this).html(html);
                                                                        break;
                                                                        case(5):
                                                                        //categories
                                                                        var html = "<select>";
                                                                        
                                                                        html = html + "<option></option>";
                                                                        $.each(json.subjectColumn, function(key,val){
                                                                               // do something with key and val
                                                                               if (json.subjectColumn.length == 1) {
                                                                               html = html + "<option selected>" + val + "</option>";
                                                                               } else {
                                                                               html = html + "<option>" + val + "</option>";
                                                                               }
                                                                               });
                                                                        
                                                                        html = html + "</select>";
                                                                        $(this).html(html);
                                                                        break;
                                                                        }
                                                                        
                                                                        count++;
                                                                        } );
                                       
                                       
                                       
                                       // Apply the search
                                       table.columns().every( function () {
                                                             var that = this;
                                                             
                                                             $( 'select', this.footer() ).on( 'change', function () {
                                                                                            if ( that.search() !== this.value ) {
                                                                                            that
                                                                                            .search( this.value )
                                                                                            .draw();
                                                                                            }
                                                                                            } );
                                                             } );

                                       } );
                              
                              
                                         });
                                         
                                         
            
                  </script>
        
        
    </body>
</html>